# PRD: tangoya (単語屋) — 일본어 JLPT 레벨 판단 앱

**문서 버전:** v2.1  
**최초 작성:** 2026-02-18 (v1.0)  
**최종 수정:** 2026-02-18 (v2.1 — 앱 이름 tangoya 반영)  
**프로젝트명:** tangoya (単語屋)  
**배포 형태:** 단일 HTML 파일 (`tangoya.html`)

---

## 1. 개요 (Overview)

### 1.1 배경
**tangoya(単語屋)** 는 일본어 학습자가 텍스트를 입력하면 각 단어의 JLPT 레벨(N1~N5)을 즉시 확인할 수 있는 웹 기반 분석 앱이다. 앱 이름 "単語屋"는 "단어 가게"를 뜻하며, 학습자가 필요한 단어 정보를 편하게 꺼내 쓸 수 있다는 콘셉트를 담고 있다. 형태소 분석 엔진을 통해 단어를 분해하고, 앱 내에 내장된 JLPT 단어 데이터와 대조하여 결과를 시각적으로 표시한다.

### 1.2 목표
- 일본어 텍스트를 입력하면 **형태소 단위**로 분해하여 각 단어의 JLPT 레벨을 판단한다.
- **설치 불필요** — HTML 파일 더블클릭만으로 실행되어 컴퓨터에 익숙하지 않은 사용자도 즉시 사용 가능하다.
- **서버 불필요** — Python, Flask 등 별도 서버 없이 브라우저만으로 완전히 동작한다.
- 결과를 **앱 내에서 시각적으로 확인**하고, **파일 다운로드**도 가능하게 한다.

### 1.3 사용 조건
- **필요한 것:** 인터넷 연결이 가능한 PC 또는 스마트폰, 최신 웹 브라우저 (Chrome / Safari / Firefox)
- **불필요한 것:** Python 설치, 서버 실행, 터미널 조작, 라이브러리 설치

---

## 2. 기술 스택 (Tech Stack)

| 구분 | 기술 | 비고 |
|------|------|------|
| 실행 형태 | 단일 HTML 파일 | 더블클릭으로 바로 실행 |
| 형태소 분석 | Kuromoji.js v0.1.2 | JavaScript 기반, MeCab·IPAdic 동일 사전 |
| 형태소 분석 사전 | kuromoji@0.1.2/dict (CDN) | 인터넷 연결 시 자동 로딩 |
| JLPT 데이터 | HTML 파일 내 직접 내장 (JSON) | 외부 파일 불필요 |
| 프론트엔드 | HTML5 + CSS3 + Vanilla JavaScript | 프레임워크 미사용 |
| 폰트 | Google Fonts CDN | Noto Serif JP, Noto Sans KR, DM Mono |
| 다운로드 | Blob API (브라우저 내장) | JSON / CSV / TXT 지원 |

---

## 3. 데이터 파이프라인 (Data Pipeline)

### 3.1 원본 데이터 구조
N1~N5 레벨별 단어 파일 5개에서 데이터를 수집하며, 각 파일의 형식은 다음과 같다.

```
읽는방법(히라가나),한자표기,JLPT레벨
예시) あう,会う,N5
```

**파일별 실제 단어 수:**

| 파일 | 라인 수 |
|------|---------|
| N5_words_naver.txt | 511줄 |
| N4_words_naver.txt | 877줄 |
| N3_words_naver.txt | 1,308줄 |
| N2_words_naver.txt | 2,262줄 |
| N1_words_naver.txt | 2,722줄 |
| **합계** | **7,680줄** |

### 3.2 내장 사전 빌드 방식
Python 스크립트로 5개 원본 파일을 읽어 **HTML 파일 내부에 직접 내장하는 JSON 사전**을 생성한다. 한자 표기와 히라가나 표기 모두 키로 등록하여 형태소 분석 결과의 다양한 표기에 대응한다.

```
N5_words_naver.txt ┐
N4_words_naver.txt │
N3_words_naver.txt ├─→ Python 빌드 스크립트 ─→ HTML 내장 JSON 사전
N2_words_naver.txt │                              (JLPT_DICT 변수)
N1_words_naver.txt ┘
```

**내장 사전 스키마:**
```json
{
  "会う":     { "r": "あう",      "l": "N5" },
  "あう":     { "r": "あう",      "l": "N5" },
  "学生":     { "r": "がくせい",  "l": "N5" },
  "がくせい": { "r": "がくせい",  "l": "N5" }
}
```
- `r` : 읽기 (히라가나)
- `l` : JLPT 레벨 (`N1`~`N5`)

**실제 내장 항목 수 (레벨별):**

| JLPT 레벨 | 내장 항목 수 |
|-----------|------------|
| N5 | 950개 |
| N4 | 1,565개 |
| N3 | 2,387개 |
| N2 | 3,967개 |
| N1 | 4,811개 |
| **합계** | **13,680개** |

> 원본 라인 수보다 많은 이유는 한자 키·히라가나 키를 각각 별도 항목으로 등록하기 때문이다.

---

## 4. 시스템 아키텍처 (System Architecture)

v1.0의 Flask 서버 방식에서 **완전 클라이언트 사이드** 구조로 변경되었다. 서버 없이 브라우저 단독으로 모든 처리를 수행한다.

```
[사용자 PC]
    │
    │  tangoya.html 더블클릭
    ▼
[브라우저]
    │
    ├── HTML/CSS/JS 로컬 파일에서 즉시 렌더링
    │
    ├── CDN (인터넷) ──→ Kuromoji.js 형태소 분석 엔진 로딩
    │                    kuromoji@0.1.2/dict (IPAdic 사전)
    │                    Google Fonts
    │
    ├── JLPT_DICT (HTML 내장) ──→ 레벨 판정
    │
    └── 결과 렌더링 + 다운로드 (Blob API)
```

**외부 의존성 요약:**

| 리소스 | URL | 용도 | 필수 여부 |
|--------|-----|------|-----------|
| Kuromoji.js | cdn.jsdelivr.net | 형태소 분석 엔진 | 필수 |
| Kuromoji dict | cdn.jsdelivr.net | IPAdic 사전 | 필수 |
| Google Fonts | fonts.googleapis.com | UI 폰트 | 선택 (없어도 동작) |

---

## 5. 기능 명세 (Feature Specifications)

### 5.1 입력 처리
- 입력 필드: 일본어 텍스트 자유 입력 (한 단어 ~ 여러 문장)
- 입력 방식: 텍스트 박스에 직접 입력 또는 붙여넣기
- 입력 길이 제한: 최대 1,000자 (HTML `maxlength` 속성으로 강제)
- Enter 키로 분석 실행 가능 (Shift+Enter는 줄바꿈)

### 5.2 형태소 분석 흐름

```
입력 텍스트
    │
    ▼
Kuromoji.js 형태소 분석 (IPAdic 사전)
    │
    ├── 각 형태소에서 추출
    │     surface_form  → 표층형 (원문 그대로)
    │     basic_form    → 사전형 (기본형)
    │     reading       → 읽기 (카타카나)
    │     pos           → 품사
    │     pos_detail_1  → 품사 세부
    │
    ├── 카타카나 읽기 → 히라가나 변환
    │
    ▼
JLPT_DICT 사전 검색 (lookupLevel 함수)
    │
    ├── 검색 우선순위: 사전형(한자) → 표층형 → 사전형(히라가나)
    ├── 복합어 처리: '·' '・' 포함 시 분리 후 재검색
    ├── 가타카나 표기: 히라가나→카타카나 변환 후 재검색
    │
    ├── 매칭 성공 → 레벨 반환
    └── 매칭 실패
          ├── 助詞·助動詞·記号·接続詞 → 레벨: "文法"
          └── 기타 → 레벨: "外"
```

### 5.3 결과 표시 규칙

#### Case A: 형태소 1개 (단어 단독 입력)
사전형을 기준으로 단일 결과를 대형 카드로 표시한다.

**표시 항목:** 읽기(히라가나) / 표층형 단어(대형, 레벨 색상 적용) / JLPT 레벨 칩 / 품사 칩 / 사전형 칩 / 사전 등재 여부

**표시 예시:**
```
      あう
    [会う]         ← 레벨 색상으로 대형 표시
  [N5] [動詞] [会う]
  JLPT N5 등재 단어
```

#### Case B: 형태소 2개 이상 (문장 또는 복수 단어)
형태소 분석 결과를 원문 순서 그대로 카드로 나열한다.

**각 카드 표시 항목 (위→아래):** 읽기 / 표층형 / JLPT 레벨 / 품사

**마우스 오버 툴팁:** 표층형 / 사전형 / 읽기 / 품사(세부 포함) / JLPT 레벨 (5개 항목)

**레벨 통계 칩:** 분석 결과 상단에 레벨별 출현 개수를 요약 표시 (N5→N4→N3→N2→N1→外→文法 순서)

**텍스트 미리보기:** 카드 하단에 `표층형[읽기, 품사, 레벨]` 형식의 텍스트 요약 표시

### 5.4 화면 레이아웃

```
┌─────────────────────────────────────────────────────┐
│  ● tangoya · 単語屋                                  │
│  日本語レベル判定                                      │
│  일본어 텍스트를 입력하면 형태소 분석 후 JLPT 레벨 판정  │
├─────────────────────────────────────────────────────┤
│  ● N1 최고급  ● N2 고급  ● N3 중급                   │
│  ● N4 초중급  ● N5 초급  ● 外 미등재                  │
├─────────────────────────────────────────────────────┤
│  일본어 입력                                          │
│  [_________________텍스트박스__________] [분석하기]   │
├─────────────────────────────────────────────────────┤
│  [N5: 2개] [N4: 1개] [文法: 1개]   ← 레벨 통계 칩    │
│  분석 결과                          ○○ 형태소         │
│                                                      │
│  ┌─────┐  ┌──┐  ┌───────┐  ┌────┐                  │
│  │わたし│  │は│  │がくせい│  │です│                  │
│  │ 私  │  │は│  │ 学生  │  │です│                  │
│  │ N5  │  │文│  │  N5   │  │ N5 │                  │
│  │名詞  │  │法│  │ 名詞  │  │助動│                  │
│  └─────┘  └──┘  └───────┘  └────┘                  │
│                                                      │
│  私[わたし, 名詞, N5] は[は, 助詞, 文法]…            │
│  ← 텍스트 미리보기                                   │
├─────────────────────────────────────────────────────┤
│  결과 다운로드                                        │
│  [⬇ JSON]  [⬇ CSV]  [⬇ TXT]                       │
└─────────────────────────────────────────────────────┘
```

### 5.5 레벨별 색상 코딩 (UI)

| JLPT 레벨 | 색상 코드 | 의미 |
|-----------|----------|------|
| N1 | `#ff4d6d` (빨강) | 최고급 |
| N2 | `#ff8800` (주황) | 고급 |
| N3 | `#ffd600` (노랑) | 중급 |
| N4 | `#00e676` (초록) | 초중급 |
| N5 | `#40c4ff` (하늘) | 초급 |
| 外 / 文法 | `#6060a0` (보라-회색) | JLPT 미등재 / 문법 요소 |

> 다크 테마 배경(`#0f0f13`) 위에 각 레벨 색상을 글자색 및 반투명 배경으로 적용한다.

### 5.6 다운로드 기능

분석 완료 후 하단에 다운로드 버튼 3개가 표시된다. 브라우저 Blob API를 사용하여 서버 없이 로컬 파일로 저장한다. 저장 파일은 모두 **UTF-8 with BOM** 인코딩이다.

**JSON 다운로드 (`jlpt_result.json`):**
```json
{
  "input": "私は学生です",
  "analyzed_at": "2026-02-18T12:00:00.000Z",
  "tokens": [
    {
      "surface": "私",
      "reading": "わたし",
      "base_form": "私",
      "pos": "名詞",
      "level": "N5"
    },
    {
      "surface": "は",
      "reading": "は",
      "base_form": "は",
      "pos": "助詞",
      "level": "文法"
    }
  ]
}
```

**CSV 다운로드 (`jlpt_result.csv`):**
```
원문,읽기,사전형,품사,JLPT레벨
私,わたし,私,名詞,N5
は,は,は,助詞,文法
学生,がくせい,学生,名詞,N5
です,です,です,助動詞,N5
```

**TXT 다운로드 (`jlpt_result.txt`):**
```
입력: 私は学生です
분석: 私[わたし, 名詞, N5] は[は, 助詞, 文法] 学生[がくせい, 名詞, N5] です[です, 助動詞, N5]
```

---

## 6. 파일 구조 (File Structure)

v2.1에서는 단일 HTML 파일 배포로 구조가 대폭 단순화되었다.

```
배포 파일/
└── tangoya.html             ← 이 파일 하나가 전체 앱 (약 571 KB)
    │
    ├── <style>               CSS 전체 내장 (다크 테마, 레벨 색상, 반응형)
    ├── JLPT_DICT (JS 변수)   N1~N5 전체 사전 데이터 내장 (13,680개)
    └── <script>              형태소 분석 + JLPT 판정 + 다운로드 로직 전체

빌드 스크립트 (개발용 — 배포 후 불필요)/
├── N1_words_naver.txt        원본 N1 단어 파일
├── N2_words_naver.txt        원본 N2 단어 파일
├── N3_words_naver.txt        원본 N3 단어 파일
├── N4_words_naver.txt        원본 N4 단어 파일
└── N5_words_naver.txt        원본 N5 단어 파일
```

---

## 7. 실행 방법 (Run Instructions)

### 7.1 사용자 실행 방법 (설치 불필요)

```
1. tangoya.html 파일을 다운로드한다.
2. 파일을 더블클릭하면 브라우저가 자동으로 열린다.
3. 인터넷에 연결된 상태에서 일본어를 입력하고 [분석하기]를 클릭한다.
```

> ⚠️ 인터넷 연결이 필요한 이유: 형태소 분석 사전(Kuromoji)을 CDN에서 자동으로 불러오기 때문이다. 사전 로딩은 최초 1회만 이루어지며, 이후 분석은 브라우저 내에서 처리된다.

### 7.2 개발자 데이터 업데이트 방법

원본 단어 파일을 수정한 뒤 Python 빌드 스크립트를 실행하면 새 HTML이 생성된다.

```bash
# 데이터 갱신 시에만 필요 (일반 사용자는 불필요)
python3 build_html.py
# → tangoya.html 재생성
```

---

## 8. 클라이언트 함수 명세

> v1.0의 서버 API 명세를 대체한다. v2.0에서는 서버 API가 없으며, 모든 로직이 브라우저 내 JavaScript 함수로 처리된다.

| 함수명 | 역할 |
|--------|------|
| `initKuromoji()` | Kuromoji.js 형태소 분석 엔진 비동기 초기화 |
| `analyze()` | 입력 텍스트 분석 실행 (버튼 클릭 / Enter 키 트리거) |
| `lookupLevel(surface, baseForm, reading)` | JLPT_DICT에서 레벨 검색 (우선순위: 사전형→표층형→읽기) |
| `showResult(tokens, inputText)` | 분석 결과를 Case A / Case B로 분기하여 렌더링 |
| `downloadJSON()` | 분석 결과를 JSON 파일로 다운로드 |
| `downloadCSV()` | 분석 결과를 CSV 파일로 다운로드 |
| `downloadTXT()` | 분석 결과를 TXT 파일로 다운로드 |

---

## 9. 예외 처리 (Edge Cases)

| 상황 | 처리 방법 |
|------|-----------|
| JLPT 미등재 일반 단어 | 레벨: `外` 표시 (보라-회색 카드) |
| 조사·조동사·접속사·기호 | 레벨: `文法` 표시 (보라-회색 카드) |
| 복합어 표기 (`·` `・` 포함) | 구분자로 분리 후 각 부분을 순서대로 재검색 |
| 가타카나 단어 | 히라가나→카타카나 변환 후 추가 검색 |
| 한자+히라가나 혼합 | Kuromoji가 사전형으로 정규화 → 사전형 기준 검색 |
| 숫자·특수기호 | 品詞: `記号` 또는 `名詞-数`, 레벨: `外` |
| 빈 입력 | 오류 메시지: "텍스트를 입력해주세요" |
| 1,000자 초과 | `maxlength` 속성으로 입력 자체가 차단됨 |
| Kuromoji 로딩 실패 (인터넷 없음) | 오류 메시지 표시, 분석 버튼 비활성화 |
| Kuromoji 로딩 중 분석 시도 | 오류 메시지: "사전 로딩 중입니다. 잠시 후 다시 시도해주세요." |

---

## 10. 개발 단계 (Development Phases)

### Phase 1: 데이터 준비 ✅ 완료
- [x] N1~N5 파일 구조 분석 및 실제 라인 수 확인
- [x] Python 빌드 스크립트 작성 (한자·히라가나 이중 키 등록)
- [x] `JLPT_DICT` JSON 생성 및 검증 (13,680개 항목)

### Phase 2: 형태소 분석 엔진 연동 ✅ 완료
- [x] Kuromoji.js CDN 연동 및 비동기 초기화
- [x] 형태소 분석 → 표층형·사전형·읽기·품사 추출
- [x] `lookupLevel` 함수 구현 (우선순위 검색 + 복합어 처리)
- [x] 카타카나→히라가나 변환 로직 구현

### Phase 3: UI 개발 ✅ 완료
- [x] 다크 테마 단일 HTML 설계 및 구현
- [x] Case A (단어 1개) 대형 카드 렌더링
- [x] Case B (문장) 형태소 카드 가로 나열 렌더링
- [x] 레벨별 색상 코딩 (N1~N5 + 外/文法)
- [x] 마우스 오버 툴팁 (5개 항목)
- [x] 레벨 통계 칩 및 텍스트 미리보기 구현
- [x] 다운로드 버튼 (JSON / CSV / TXT)
- [x] 반응형 레이아웃 (모바일 480px 이하 대응)
- [x] Enter 키 분석 실행 지원

### Phase 4: 통합 및 배포 ✅ 완료
- [x] 단일 HTML 파일로 통합
- [x] 최종 파일 크기 확인 (571 KB)
- [x] 다운로드 파일 UTF-8 BOM 인코딩 적용

---

## 11. 테스트 케이스 (Test Cases)

| 입력 | 예상 결과 모드 | 레벨 판정 예시 |
|------|----------------|----------------|
| `会う` | Case A (단어) | N5 |
| `食べる` | Case A (단어) | N5 |
| `私は学生です` | Case B (문장) | 私:N5, は:文法, 学生:N5, です:N5 |
| `東京は大きい都市です` | Case B (문장) | 각 형태소별 레벨 카드 나열 |
| `xyz` | Case B | 外 |
| `ありがとう` | Case A | N5 (`有り難う`) |
| ` ` (공백) | — | 오류: "텍스트를 입력해주세요" |
| 1,001자 입력 | — | 입력 자체가 차단됨 (maxlength=1000) |

---

## 12. 품질 기준 (Quality Criteria)

- **분석 응답 시간:** 사전 로딩 완료 후 입력→결과 **1초 이내**
- **단어 커버리지:** N1~N5 원본 단어 파일 **100%** 내장 (13,680개 항목)
- **형태소 분석 정확도:** Kuromoji.js (IPAdic) 기준 **90% 이상**
- **다운로드 파일 인코딩:** **UTF-8 with BOM** (Excel 등에서 한국어·일본어 정상 표시)
- **크로스 브라우저:** Chrome, Safari, Firefox 최신 버전 지원
- **반응형:** 모바일 (480px 이하) 레이아웃 자동 전환
- **배포 편의성:** 단일 HTML 파일 1개로 배포 완결

---

## 13. 버전 변경 이력

| 항목 | v1.0 (초기 계획) | v2.0 (구현 반영) | v2.1 (현재) |
|------|-----------------|-----------------|-------------|
| 앱 이름 | JLPT Word Level Analyzer | JLPT Word Level Analyzer | **tangoya (単語屋)** |
| 배포 파일명 | `JLPT_Analyzer.html` | `JLPT_Analyzer.html` | **`tangoya.html`** |
| 실행 방법 | `python app.py` 후 브라우저 접속 | HTML 파일 더블클릭 | HTML 파일 더블클릭 |
| 서버 | Flask (Python) 필요 | 서버 없음 (브라우저 단독) | 서버 없음 (브라우저 단독) |
| 형태소 분석 엔진 | MeCab (Python) | Kuromoji.js (JavaScript) | Kuromoji.js (JavaScript) |
| JLPT 데이터 위치 | 외부 `jlpt_dict.json` 파일 | HTML 내 JS 변수로 직접 내장 | HTML 내 JS 변수로 직접 내장 |
| 데이터 항목 | 읽기 + 레벨 + 품사 + 한국어 뜻 | 읽기 + 레벨 (품사는 Kuromoji 실시간 추출) | 읽기 + 레벨 (품사는 Kuromoji 실시간 추출) |
| 파일 구성 | 다수 파일 (app.py, analyzer.py 등) | 단일 HTML 파일 1개 | 단일 HTML 파일 1개 |
| 설치 요구사항 | Python, MeCab, Flask 필요 | 없음 (인터넷 연결만 필요) | 없음 (인터넷 연결만 필요) |
| 문법 요소 레벨 표기 | `"-"` | `"文法"` (시각적으로 구분) | `"文法"` (시각적으로 구분) |
| UI 테마 | 라이트 계열 | 다크 테마 + 채도 높은 레벨 색상 | 다크 테마 + 채도 높은 레벨 색상 |
| 배포 파일 크기 | 미정 | 571 KB (단일 파일) | 571 KB (단일 파일) |

---

*본 문서는 실제 구현 완료된 `tangoya.html` (v2.1) 기준으로 작성되었습니다.*
